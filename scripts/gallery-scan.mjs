import fs from 'node:fs'; import path from 'node:path'; import url from 'node:url'; const __dirname=path.dirname(url.fileURLToPath(import.meta.url)); const root=path.join(__dirname,'..'); const pub=path.join(root,'public','gallery'); const out=path.join(root,'content','gallery'); if(!fs.existsSync(pub)){ console.error('No public/gallery folder found.'); process.exit(1); } const albums=fs.readdirSync(pub).filter(d=>fs.statSync(path.join(pub,d)).isDirectory()); const index=[]; for(const album of albums){ const dir=path.join(pub,album); const files=fs.readdirSync(dir).filter(f=>/\.(jpe?g|png|webp)$/i.test(f)); const items=files.map(f=>({ type:'image', src:`/gallery/${album}/${f}`, thumb:`/gallery/${album}/${f}` })); const cover=items[0]?.thumb ?? ''; fs.writeFileSync(path.join(out,`${album}.json`), JSON.stringify(items,null,2)); index.push({ slug: album, title: album.replace(/[-_]/g,' ').replace(/\b\w/g,c=>c.toUpperCase()), count: items.length, cover }); } fs.writeFileSync(path.join(out,'index.json'), JSON.stringify(index,null,2)); console.log('Gallery index generated:', index.map(a=>a.slug).join(', '));
